# 分布式调度对比

|对比内容|cronsun|xxl-job	|Elastic-job|saturn|lts|TBSchedule|
|---|---|---|---|---|---|---|
|项目背景|替代crontab|大众点评、文档齐全|当当网开源、文档齐全|唯品会自主研发，基于当当的Elastic-job版本1||阿里早期开源、代码略陈旧|
|语言|Go|Java|Java|Java|Java|Java|
|依赖|etcd、mongodb|mysql,jdk1.7+,maven3.0+|jdk1.7+, zookeeper 3.4.6+ ,maven3.0.4+ ,mesos，mysql|JDK 7 or JDK 8,Maven 3.0.4+,node.js 8.7.0+,npm 5.4.2+,docker (版本不限)|CentOs,maven, java, MySQL||
|多平台接入||大众点评、优信二手车等70个以上的公司接入||||
|易用、易部署|安装简单、使用简便|支持通过Web页面对任务进行CRUD操作，操作简单，一分钟上手|易用易部署|可以很好的部署到docker容器上|易用，难部署||
|web界面统一管理任务|cronweb界面可以管理任务|xxl-job-admin提供了web界面，同时也是作为任务调度中心|提供运维界面elastic-job-lite-console，可以管理作业和注册中心|Saturn Console|lts-admin|
|多节点部署时任务不能重复执行|支持任务单次执行|“调度中心”通过DB锁保证集群分布式调度的一致性, 一次任务调度只会触发一次执行|容错处理：作业服务器与Zookeeper服务器通信失败则立即停止作业运行，防止作业注册中心将失效的分片分项配给其他作业服务器，而当前作业服务器仍在执行任务，导致重复执行；幂等性：重复作业任务项判定，不重复执行已运行的作业任务项||容错处理|支持|
|日志可追溯|有日志查询界面，并已支持日志清除|支持在线查看调度结果，并且支持以Rolling方式实时查看执行器输出的完整的执行日志（数据库）|支持，有日志查询界面，job的运行日志将会记录到数据库里|saturn-executor-log.log(executor日志)，saturn-executor.log(job日志)|在TaskTracker端提供了业务日志记录器|
|弹性扩容缩容||一旦有新执行器机器上线或者下线，下次调度时将会重新分配任务|运行中的作业服务器崩溃，或新增加n台作业服务器，作业框架将在下次作业执行前重新分片，不影响当前作业执行|能支持容器化技术进行自动executor扩容和减容，保证高峰期处理能力的弹性伸缩。|因为LTS各个节点都是无状态的，所以支持动态增加删除节点，达到负载均衡的目的|（2） TBSchedule的宿主服务器可以进行动态的扩容和资源回收|
|报警|邮件提醒，由cronweb界面发出，而不是cronnode|任务失败邮件报警，支持配置多邮箱地址，用逗号隔开|可通过事件订阅自行实现|Saturn提供了完善的监控告警机制，能方便开发者进行监控|
|阻塞处理策略|多机单任务(防止单机挂掉任务不按时执行)|策略包括：单机串行、丢弃后续调度、覆盖之前的调度|zk的session timeout时间，超过这个时间临时节点将会被清除，作业才会重新分片|设置了timeout的作业开始执行后会启动超时检测，如果执行超时，则会停止当前作业的执行|
|支持并行调度|多节点|调度系统多线程触发调度运行，确保调度精确执行，不被阻塞|将一个任务分为多个小任务在多台服务器上执行|分片|多节点|支持|
|失败处理策略|任务失败重试|失败告警、失败重试|失败转移、被错过的作业重触发|支持作业HA，负载均衡和失败转移|当节点组中的一个节点宕机之后，自动转到其他节点工作。当整个节点组宕机之后，将会采用存储文件的方式，待节点组可用的时候进行重发。 当执行任务的TaskTracker节点宕机之后，JobTracker 会将这个TaskTracker上的未完成的任务(死任务)，重新分配给节点组中其他节点执行。|失效转移|
|高可用|当某个节点死机的时候可以自动调度到正常的节点执行|如果执行器集群中某一台机器故障，将会自动Failover切换到一台正常的执行器发送调度请求|调度器的高可用是通过运行几个指向同一个ZooKeeper集群的Elastic-Job-Cloud-Scheduler实例来实现的。ZooKeeper用于在当前主Elastic-Job-Cloud-Scheduler实例失败的情况下执行领导者选举。通过至少两个调度器实例来构成集群，集群中只有一个调度器实例提供服务，其他实例处于”待命”状态。当该实例失败时，集群会选举剩余实例中的一个来继续提供服务。|Saturn是面向任务的，能够监控到executor的状态，在executor下线或者上线的时，均会对任务分片进行重分配，保证其可用性。|由于上面的失败处理策略，实现了任务的高可用|支持|
|路由策略|故障转移|第一个、最后一个、轮询、随机、一致性HASH、最不经常使用、最近最久未使用、故障转移、忙碌转移等|失效转移|失败转移、负载均衡|故障转移|	
|动态分片||分片广播任务以执行器为维度进行分片，支持动态扩容执行器集群从而动态增加分片数量，协同进行业务处理；在进行大数据量业务操作时可显著提升任务处理能力和速度。|默认包含三种分片策略： 基于平均分配算法的分片策略、 作业名的哈希值奇偶数决定IP升降序算法的分片策略、根据作业名的哈希值对Job实例列表进行轮转的分片策略，支持自定义分片策略|由用户在UI界面输入||TBSchedule的分布式机制是通过灵活的Sharding方式实现的，比如可以按所有数据的ID按10取模分片、按月份分片等，根据不同的场景由客户端配置分片规则。|
|任务类型|普通任务、单机单进程任务、一个任务执行间隔内允许执行一次|提供Web IDE，支持在线开发任务逻辑代码，动态发布，实时编译生效，省略部署上线的过程。支持30个版本的历史版本回溯。支持以GLUE模式开发和运行脚本任务，包括Shell、Python、NodeJS等类型脚本|支持OneOff，Perpetual和SequencePerpetual三种作业模式	提供除java作业的基础上增加了shell作业的支持。主要可以支持类似PHP, Python等脚本作业|实时任务：提交了之后立即就要执行的任务;定时任务：在指定时间点执行的任务，譬如 今天3点执行（单次）;Cron任务：CronExpression，和quartz类似（但是不是使用quartz实现的）譬如 0 0/1 * ?;Repeat任务：譬如每隔5分钟执行一次，重复50次就停止。|
|任务在业务中的状态流转|所有的任务都会存储在一个分布式etcd里，单个crond部署成一个服务，也就是图中所示的node.1、node.2、node.n等，然后再由web界面去管理|将调度的行为抽象成“调度中心”公共平台，“调度中心”负责发起调度请求，将任务抽象成JobHandler，交由执行器管理，执行器负责接收调度请求并执行相应的JobHandler中的业务逻辑|首先配置任务的相关信息，然后任务去注册中心进行注册，注册中心完成主节点选举和分片策略的设置。Quarzt job一旦触发，则任务执行。任务执行后，处理错过的任务以及监听事件|将作业在逻辑上划分为若干个分片，通过作业分片调度器将作业分片指派给特定的执行节点。执行节点通过quartz触发执行作业的具体实现，在执行的时候，会将分片序号和参数作为参数传入。作业的实现逻辑需分析分片序号和分片参数，并以此为依据来调用具体的实现|任务到注册中心进行注册，JobClient将任务进行提交，JobTracker接收并分配任务，TaskTracker执行任务，并将结果反馈给客户端|
|任务进度监控|在cronweb添加完成任务之后，在任务标签页就能看到所有添加的定时任务以及执行情况|支持实时监控任务进度|监控作业运行时状态，统计最近一段时间处理的数据成功和失败数量，记录作业上次运行开始时间，结束时间和下次运行时间。|Saturn通过统一的控制台进行全部域及全部作业的配置，执行情况监控，结点监控等|这些业务日志可以通过任务ID串联起来，可以在LTS-Admin中实时查看任务的执行进度|schedule管理控制台。负责控制、监控任务执行状态。|
|自定义任务参数|在cronweb添加定时任务时，可以指定任务执行脚本和参数	|支持在线配置调度任务入参，即时生效|在修改任务时，可以自定义参数|可以在界面中配置任务的参数|||
|安全设置|支持security.json安全设置|调度中心向执行器发送的调度请求时使用RequestModel和ResponseModel两个对象封装调度请求参数和响应数据, 在进行通讯之前底层会将上述两个对象对象序列化，并进行数据协议以及时间戳检验,从而达到数据加密的功能	||||		
|开源地址|http://github.com/shunfei/cronsun|https://github.com/xuxueli/xxl-job|https://github.com/elasticjob/elastic-job-lite|https://github.com/vipshop/Saturn|https://github.com/ltsopensource/light-task-scheduler||

	




